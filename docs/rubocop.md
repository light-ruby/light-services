# RuboCop Integration

Light Services provides custom RuboCop cops to help enforce best practices in your service definitions.

## Setup

Add this to your `.rubocop.yml`:

```yaml
require:
  - light/services/rubocop
```

## Available Cops

### LightServices/ArgumentTypeRequired

Ensures all `arg` declarations include a `type:` option.

```ruby
# bad
arg :user_id
arg :params, default: {}

# good
arg :user_id, type: Integer
arg :params, type: Hash, default: {}
```

### LightServices/OutputTypeRequired

Ensures all `output` declarations include a `type:` option.

```ruby
# bad
output :result
output :data, optional: true

# good
output :result, type: Hash
output :data, type: Hash, optional: true
```

### LightServices/StepMethodExists

Ensures all `step` declarations have a corresponding method defined.

```ruby
# bad
class MyService < ApplicationService
  step :validate
  step :process  # missing method

  private

  def validate; end
end

# good
class MyService < ApplicationService
  step :validate
  step :process

  private

  def validate; end
  def process; end
end
```

**Configuration:** Use `ExcludedSteps` for inherited steps:

```yaml
LightServices/StepMethodExists:
  ExcludedSteps:
    - initialize_entity
    - assign_attributes
```

### LightServices/ConditionMethodExists

Ensures symbol conditions (`:if`, `:unless`) have corresponding methods defined.

This cop automatically recognizes predicate methods generated by `arg` and `output` declarations (e.g., `arg :user` creates `user?`).

```ruby
# bad
class MyService < ApplicationService
  step :notify, if: :should_notify?  # missing method

  private

  def notify; end
end

# good - explicit method
class MyService < ApplicationService
  step :notify, if: :should_notify?

  private

  def notify; end
  def should_notify?; true; end
end

# good - predicate from arg/output
class MyService < ApplicationService
  arg :user, type: User, optional: true

  step :greet, if: :user?  # user? is auto-generated

  private

  def greet; end
end
```

**Configuration:** Use `ExcludedMethods` for inherited condition methods:

```yaml
LightServices/ConditionMethodExists:
  ExcludedMethods:
    - admin?
    - guest?
```

### LightServices/DslOrder

Enforces consistent ordering of DSL declarations: `config` → `arg` → `step` → `output`

```ruby
# bad
class MyService < ApplicationService
  step :process
  arg :name, type: String
  config raise_on_error: true
end

# good
class MyService < ApplicationService
  config raise_on_error: true

  arg :name, type: String

  step :process

  output :result, type: Hash
end
```

### LightServices/MissingPrivateKeyword

Ensures step methods are defined as private.

```ruby
# bad
class MyService < ApplicationService
  step :process

  def process  # should be private
    # implementation
  end
end

# good
class MyService < ApplicationService
  step :process

  private

  def process
    # implementation
  end
end
```

### LightServices/NoDirectInstantiation

Prevents direct instantiation of service classes with `.new`.

```ruby
# bad
UserService.new(name: "John")

# good
UserService.run(name: "John")
UserService.run!(name: "John")
UserService.call(name: "John")
```

**Configuration:** Customize the pattern for service class detection:

```yaml
LightServices/NoDirectInstantiation:
  ServicePattern: 'Service$'  # default: matches classes ending with "Service"
```

## Configuration

Full configuration example:

```yaml
require:
  - light/services/rubocop

LightServices/ArgumentTypeRequired:
  Enabled: true

LightServices/OutputTypeRequired:
  Enabled: true

LightServices/StepMethodExists:
  Enabled: true
  ExcludedSteps: []

LightServices/ConditionMethodExists:
  Enabled: true
  ExcludedMethods: []

LightServices/DslOrder:
  Enabled: true

LightServices/MissingPrivateKeyword:
  Enabled: true

LightServices/NoDirectInstantiation:
  Enabled: true
  ServicePattern: 'Service$'
```

To disable a cop for specific files:

```yaml
LightServices/ArgumentTypeRequired:
  Exclude:
    - 'spec/**/*'
    - 'test/**/*'
```

## What's Next?

Learn more about testing your services:

[Next: Testing](testing.md)
